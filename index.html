<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pok√©dex</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #f0f0f0;
      font-family: sans-serif;
    }
    svg {
      display: block;
      margin: 30px auto;
      background-color: #e74c3c;
      border-radius: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    #pokemon-name {
      fill: #ecf0f1;
      font-size: 20px;
      font-weight: bold;
      text-anchor: middle;
      text-transform: uppercase;
    }
    #pokemon-sprite {
      image-rendering: pixelated;
    }
  </style>
</head>
<body>
  <svg id="pokedex" width="620" height="420"></svg>
  <script>
    const svg = d3.select("#pokedex");
    let currentPokemonId = 1;
    let totalPokemon = 0;
    let direction = "right";
    

    let pokemonStats = {};
    d3.json("pokemons.json").then(data => {
      pokemonStats = data;
      totalPokemon = Object.keys(pokemonStats).length;
      updatePokemon(currentPokemonId);
    });


    const defs = svg.append("defs");
    const gradient = defs.append("linearGradient")
      .attr("id", "panelGradient")
      .attr("x1", "0%").attr("y1", "0%").attr("x2", "100%").attr("y2", "100%");
    gradient.append("stop").attr("offset", "0%").attr("stop-color", "#c0392b");
    gradient.append("stop").attr("offset", "100%").attr("stop-color", "#a5281a");

    svg.append("rect").attr("x", 300).attr("y", 0).attr("width", 20).attr("height", 420)
      .attr("fill", "#8e1e16").attr("rx", 5);

    const left = svg.append("g").attr("id", "left-panel");

    left.append("rect")
      .attr("x", 10).attr("y", 10).attr("width", 300).attr("height", 400)
      .attr("fill", "url(#panelGradient)").attr("rx", 15).attr("stroke", "#8e1e16").attr("stroke-width", 3);

    left.append("circle").attr("cx", 50).attr("cy", 40).attr("r", 20).attr("fill", "#3498db")
      .attr("stroke", "#ecf0f1").attr("stroke-width", 3);

    left.selectAll("circle.led")
      .data([0, 1, 2])
      .enter()
      .append("circle")
      .attr("cx", (d, i) => 100 + i * 20)
      .attr("cy", 40)
      .attr("r", 5)
      .attr("fill", (d, i) => ["#e74c3c", "#2ecc71", "#f1c40f"][i])
      .attr("stroke", "#ecf0f1");

    const screen = left.append("g").attr("id", "main-screen");

    defs.append("clipPath").attr("id", "sprite-mask")
      .append("rect").attr("x", 50).attr("y", 70).attr("width", 220).attr("height", 180);

    screen.append("rect")
      .attr("x", 50).attr("y", 70).attr("width", 220).attr("height", 180)
      .attr("fill", "#222").attr("rx", 10).attr("stroke", "#ecf0f1").attr("stroke-width", 2);

    const pokemonName = screen.append("text")
      .attr("id", "pokemon-name")
      .attr("x", 160).attr("y", 95)
      .attr("textLength", 200)
      .attr("lengthAdjust", "spacingAndGlyphs");

    const pokemonSprite = screen.append("image")
      .attr("id", "pokemon-sprite")
      .attr("clip-path", "url(#sprite-mask)")
      .attr("x", 110)
      .attr("y", 105)
      .attr("width", 120)
      .attr("height", 120);

    // Group for multiple type icons
    const typeGroup = screen.append("g")
      .attr("id", "type-group");

    const dpad = left.append("g").attr("transform", "translate(230, 310)");
    const armLength = 20, armThickness = 14, centerSize = 16;

    dpad.append("rect").attr("x", -armThickness / 2).attr("y", -armLength - centerSize / 2)
      .attr("width", armThickness).attr("height", armLength).attr("fill", "#2c3e50");
    dpad.append("rect").attr("x", -armThickness / 2).attr("y", centerSize / 2)
      .attr("width", armThickness).attr("height", armLength).attr("fill", "#2c3e50");
    dpad.append("rect").attr("x", -armLength - centerSize / 2).attr("y", -armThickness / 2)
      .attr("width", armLength).attr("height", armThickness).attr("fill", "#2c3e50").on("click", () => { direction = "left"; scrollLeft(); });
    dpad.append("rect").attr("x", centerSize / 2).attr("y", -armThickness / 2)
      .attr("width", armLength).attr("height", armThickness).attr("fill", "#2c3e50").on("click", () => { direction = "right"; scrollRight(); });
    dpad.append("rect").attr("x", -centerSize / 2).attr("y", -centerSize / 2)
      .attr("width", centerSize).attr("height", centerSize).attr("fill", "#34495e");

    const right = svg.append("g").attr("id", "right-panel");

    right.append("rect").attr("x", 310).attr("y", 10).attr("width", 300).attr("height", 400)
      .attr("fill", "url(#panelGradient)").attr("rx", 15).attr("stroke", "#8e1e16").attr("stroke-width", 3);

    right.append("rect").attr("x", 340).attr("y", 40).attr("width", 240).attr("height", 100)
      .attr("fill", "#222").attr("rx", 10).attr("stroke", "#ecf0f1").attr("stroke-width", 2);

    right.append("rect").attr("x", 340).attr("y", 160).attr("width", 240).attr("height", 50)
      .attr("fill", "#222").attr("rx", 5).attr("stroke", "#ecf0f1").attr("stroke-width", 2);

    const btnGrid = right.append("g").attr("transform", "translate(340, 230)");
    btnGrid.selectAll("rect.blue-btn")
      .data(d3.range(6))
      .enter()
      .append("rect")
      .attr("x", (d, i) => (i % 3) * 60)
      .attr("y", (d, i) => Math.floor(i / 3) * 40)
      .attr("width", 50).attr("height", 30)
      .attr("fill", "#3498db").attr("rx", 5).attr("stroke", "#2980b9").attr("stroke-width", 2);

    function updatePokemon(id) {
      fetch(`https://pokeapi.co/api/v2/pokemon/${id}/`)
        .then(res => res.json())
        .then(data => {
          const name = data.name;
          const localName = name.charAt(0).toUpperCase() + name.slice(1);

          // Only show if it's in the pokemons.json dataset
          const localData = pokemonStats[localName];
          if (!localData || !localData.Type) {
            scrollRight();
            return;
          }

          const displayName = name.toUpperCase();
          pokemonName.text(displayName);

          // Update sprite with no transition
          pokemonSprite
            .attr("href", data.sprites.front_default)
            .attr("opacity", 1)
            .attr("x", 110);

          // Update types
          const types = localData.Type.split(',').map(t => t.toLowerCase().trim());
          const iconSize = 24;
          const padding = 6;
          const baseX = 61;
          const baseY = 215;

          d3.select("#type-group").selectAll("image").remove();
          d3.select("#type-group")
            .selectAll("image")
            .data(types)
            .enter()
            .append("image")
            .attr("href", d => `icons/${d}.svg`)
            .attr("x", (d, i) => baseX + i * (iconSize + padding))
            .attr("y", baseY)
            .attr("width", iconSize)
            .attr("height", iconSize);
        })
        .catch(() => {
          scrollRight();
        });
    }

    function scrollRight() {
      currentPokemonId = (currentPokemonId % totalPokemon) + 1;
      updatePokemon(currentPokemonId);
    }

    function scrollLeft() {
      currentPokemonId = (currentPokemonId - 2 + totalPokemon) % totalPokemon + 1;
      updatePokemon(currentPokemonId);
    }
  </script>
</body>
</html>
